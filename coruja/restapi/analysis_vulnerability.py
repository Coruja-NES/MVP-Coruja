from flask import Blueprint, Flask, flash, redirect, render_template, url_for
from flask_login import login_required

from ..decorators import proxy_access
from ..forms import DefaultForm
from ..utils import database_manager, form_to_dict

bp = Blueprint("analysis_vulnerability", __name__, "analise-vulnerabilidade")


@bp.route("/<int:analysis_vulnerability_id>")
@login_required
@proxy_access(kind_object="analysis_vulnerability", kind_access="read")
def get_analysis(analysis_vulnerability_id: int):
    """Renderiza detalhes sobre uma determinada Análise de Vulnerabilidade

    Args:
        analysis_vulnerability_id (int): ID da Análise de Vulnerabilidade
    """

    analysis_vulnerability = database_manager.get_analysis_vulnerability(
        analysis_vulnerability_id
    )

    return render_template(
        "analysis_risk/analysis_vulnerability.html",
        analysis_vulnerability=analysis_vulnerability,  # type: ignore
    )


def init_api(app: Flask) -> None:
    app.register_blueprint(bp)
